{% extends 'adminpanel/base_admin.html' %}
{% block title %}Category Management{% endblock %}

{% block content %}

{% include 'adminpanel/partials/breadcrumb.html' %}

<div x-data="{ openAddModal: false, confirmOpen: false, confirmUrl: '', confirmText: '' }" class="p-6">

    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-semibold text-white">Category Management</h1>

        <button @click="openAddModal = true"
                class="bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-md shadow">
            + Add Subcategory
        </button>
    </div>

    <!-- Table -->
    <div class="bg-[#1A1A1A] border border-border rounded-xl overflow-hidden shadow">
        <table class="min-w-full text-white">
            <thead class="bg-[#1F1F1F] text-gray-300 uppercase text-sm">
                <tr>
                    <th class="px-6 py-3 text-left">#</th>
                    <th class="px-6 py-3 text-left">Subcategory</th>
                    <th class="px-6 py-3 text-left">Category</th>
                    <th class="px-6 py-3 text-left">Status</th>
                    <th class="px-6 py-3 text-center">Actions</th>
                </tr>
            </thead>

            <tbody>
                {% for sub in subcategories %}
                <tr class="border-t border-border hover:bg-[#2A2A2A] transition">

                    <td class="px-6 py-4">{{ forloop.counter }}</td>
                    <td class="px-6 py-4 font-medium">{{ sub.name }}</td>
                    <td class="px-6 py-4">{{ sub.category }}</td>

                    <td class="px-6 py-4">
                        {% if sub.is_active %}
                            <span class="px-2 py-1 text-xs bg-green-700 text-white rounded">Active</span>
                        {% else %}
                            <span class="px-2 py-1 text-xs bg-red-700 text-white rounded">Inactive</span>
                        {% endif %}
                    </td>

                    <td class="px-6 py-4 text-center space-x-3">

                        <!-- Edit -->
                        <a href="{% url 'admin_category_edit' sub.id %}" 
                           class="text-blue-400 hover:underline">Edit</a>

                        <!-- Delete -->
                        <button 
                            @click="
                                confirmOpen = true; 
                                confirmUrl = '{% url 'admin_category_delete' sub.id %}';
                                confirmText = 'Delete subcategory {{ sub.name }}?';
                            "
                            class="text-red-400 hover:underline">
                            Delete
                        </button>
                    </td>

                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center py-6 text-gray-400">
                        No subcategories yet.
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

    <!-- ADD MODAL -->
    <div x-show="openAddModal"
         class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"
         x-transition>
        <div class="bg-[#1A1A1A] p-6 rounded-2xl w-[26rem] shadow-xl border border-border relative">

            <!-- Close -->
            <button @click="openAddModal = false"
                    class="absolute top-3 right-3 text-gray-400 hover:text-white text-2xl">&times;</button>

            <h2 class="text-xl font-semibold mb-5 text-white border-b border-border pb-2">
                Add Subcategory
            </h2>

            <form method="POST" action="{% url 'admin_category_add' %}" class="space-y-4">
                {% csrf_token %}

                <!-- Category -->
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Category</label>
                    <select name="category"
                            class="bg-[#1F1F1F] border border-border text-white rounded-md px-4 py-3 w-full">
                        <option value="MEN">Men</option>
                        <option value="WOMEN">Women</option>
                        <option value="KIDS">Kids</option>
                    </select>
                </div>

                <!-- Subcategory -->
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Subcategory Name</label>
                    <input type="text" name="name"
                           class="w-full p-3 rounded-md bg-[#1F1F1F] text-white border border-border"
                           placeholder="e.g. Running Shoes" required>
                </div>

                <!-- Status -->
                <div class="flex items-center space-x-2">
                    <input type="checkbox" name="is_active" checked>
                    <label class="text-sm text-gray-400">Active</label>
                </div>

                <!-- Buttons -->
                <div class="flex justify-end gap-2 pt-3">
                    <button type="button"
                            @click="openAddModal=false"
                            class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md">
                        Cancel
                    </button>

                    <button type="submit"
                            class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md">
                        Add
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- CONFIRM DELETE MODAL -->
    <div x-show="confirmOpen"
         class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50"
         x-transition>
         
        <div class="bg-[#1A1A1A] p-6 rounded-xl w-[22rem] shadow-xl border border-border relative">
            <h2 class="text-xl font-semibold mb-4 text-white" x-text="confirmText"></h2>

            <div class="flex justify-end gap-3">
                <button 
                    @click="confirmOpen=false"
                    class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md">
                    Cancel
                </button>

                <a :href="confirmUrl"
                   class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md">
                    Confirm
                </a>
            </div>
        </div>
    </div>

</div>

{% endblock %}
