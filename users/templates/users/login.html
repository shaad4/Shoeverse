{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="bg-dark min-h-screen flex items-center justify-center py-5">
    <div class="w-full flex justify-center items-center py-5 px-5 md:px-40">
        
        <div class="w-full max-w-[960px] flex flex-col items-center">
            
            <div class="w-full flex justify-center px-4 pt-5 pb-3">
                <h1 class="text-[28px] font-bold text-white text-center leading-[1.25em]">
                    Step into your next style.
                </h1>
            </div>

            {% if messages %}
                {% for message in messages %}
                    <div class="w-full max-w-[480px] mb-4 px-4">
                        <div class="p-3 rounded-card text-white text-center text-sm font-medium
                            {% if message.tags == 'error' %} bg-red-500/80
                            {% elif message.tags == 'success' %} bg-green-600/80
                            {% else %} bg-dark-green
                            {% endif %} border border-white/10">
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <form id="loginForm" method="POST" class="w-full max-w-[480px] flex flex-col items-stretch px-4">
                {% csrf_token %}

                <div class="w-full mb-4">
                    <input 
                        type="email" 
                        name="email"
                        placeholder="Email Address"
                        class="form-input w-full h-14 bg-dark-green text-white placeholder-muted text-base px-4 py-4 rounded-card border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition-all"
                        required
                    >
                </div>

                <div class="w-full mb-2 relative">
                    <input 
                        type="password" 
                        id="password"
                        name="password"
                        placeholder="Password"
                        class="form-input w-full h-14 bg-dark-green text-white placeholder-muted text-base px-4 py-4 rounded-card border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition-all"
                        required
                    >
                    <button type="button" class="togglePass absolute right-4 top-[18px] text-muted text-sm hover:text-white transition-colors">Show</button>
                </div>

                <div class="w-full text-right mb-4 px-1">
                    <a href="{% url 'forgot_password' %}" class="text-[12px] text-muted hover:text-primary transition-colors">
                        Forgot password?
                    </a>
                </div>

                <div class="w-full mb-3">
                    <button 
                        id="loginBtn"
                        type="submit"
                        disabled
                        class="w-full h-14 bg-primary text-dark font-bold text-sm rounded-card opacity-50 cursor-not-allowed transition-all hover:scale-[1.01] active:scale-95">
                        Login
                    </button>
                </div>
            </form>
            <div class="w-full flex justify-center items-center my-6 px-4">
                <div class="h-[1px] bg-gray-700 flex-grow"></div>
                <span class="text-small text-muted px-4 font-medium">OR</span>
                <div class="h-[1px] bg-gray-700 flex-grow"></div>
            </div>

            <div class="w-full max-w-[480px] px-4 mb-3">
                <a href="/accounts/google/login/" 
                   class="w-full h-14 bg-dark-green text-white font-bold text-sm rounded-card 
                          flex items-center justify-center gap-3 border border-gray-700 hover:bg-gray-800 transition-all">
                    <img src="{% static 'images/google-icon.svg' %}" alt="Google icon" class="w-[22px] h-[22px]">
                    <span>Continue with Google</span>
                </a>
            </div>

            <div class="w-full flex justify-center mt-4 px-4 pb-3">
                <p class="text-small text-muted text-center">
                    Don't have an account?
                    <a href="{% url 'signup' %}" class="text-primary font-bold hover:underline ml-1">
                        Sign up
                    </a>
                </p>
            </div>

        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {

    function clearErrors(field) {
        let input = $(`input[name='${field}']`);
        input.removeClass("border-red-500");
        input.closest('div').find(".error-text").remove();
    }

    function showError(field, msg) {
        let input = $(`input[name='${field}']`);
        if (!input.closest('div').find(".error-text").length) {
            input.addClass("border-red-500");
            input.after(`<p class="error-text text-red-500 text-[12px] mt-1 ml-1 font-medium">${msg}</p>`);
        }
    }

    function validateForm() {
        let valid = true;
        let email = $("input[name='email']").val().trim();
        let pass = $("input[name='password']").val().trim();

        // Email Validation
        let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (email.length > 0) {
            if (!emailRegex.test(email)) {
                showError("email", "Invalid email address");
                valid = false;
            } else {
                clearErrors("email");
            }
        } else {
            valid = false;
        }

        // Password Validation (Check for minimum length to match system rules)
        if (pass.length > 0) {
            if (pass.length < 6) {
                showError("password", "Password must be at least 6 characters");
                valid = false;
            } else {
                clearErrors("password");
            }
        } else {
            valid = false;
        }

        // Final Button State
        if (emailRegex.test(email) && pass.length >= 6) {
            $("#loginBtn").prop("disabled", false)
                .removeClass("opacity-50 cursor-not-allowed")
                .addClass("opacity-100 cursor-pointer");
        } else {
            $("#loginBtn").prop("disabled", true)
                .addClass("opacity-50 cursor-not-allowed")
                .removeClass("opacity-100 cursor-pointer");
        }
    }

    // Input listeners
    $("input").on("input focusout", validateForm);

    // Show/Hide Password Toggle
    $(".togglePass").on("click", function () {
        let input = $(this).closest('div').find('input');
        let isPass = input.attr("type") === "password";
        input.attr("type", isPass ? "text" : "password");
        $(this).text(isPass ? "Hide" : "Show");
    });
});
</script>

{% endblock content %}