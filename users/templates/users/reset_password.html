{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="min-h-screen flex items-center justify-center bg-dark px-5 pt-24">

    <div class="w-full max-w-[400px] bg-dark p-6 rounded-lg">

        <h1 class="text-white text-2xl font-bold mb-4 text-center">
            Reset Password
        </h1>

        {% if messages %}
            {% for message in messages %}
                <p class="p-3 rounded text-white mb-3
                    {% if message.tags == 'error' %} bg-red-600
                    {% else %} bg-green-600 {% endif %}">
                    {{ message }}
                </p>
            {% endfor %}
        {% endif %}

        <form method="POST" id="resetForm">
            {% csrf_token %}

            <div class="mb-3">
                <input type="password" name="password" placeholder="New Password"
                    class="form-input w-full h-12 bg-dark-green text-white px-4 rounded outline-none border-0"
                    required>
            </div>

            <div class="mb-3">
                <input type="password" name="confirm_password" placeholder="Confirm Password"
                    class="form-input w-full h-12 bg-dark-green text-white px-4 rounded outline-none border-0"
                    required>
            </div>

            <button id="resetBtn" class="w-full h-12 bg-primary text-dark font-bold rounded opacity-60 cursor-not-allowed">
                Reset Password
            </button>
        </form>

        <!-- Error container -->
        <div id="error-box" class="mt-3"></div>

    </div>

</div>

<!-- âœ… jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(document).ready(function () {

    function clearErrors() {
        $("#error-box").html("");
        $("input").removeClass("border-red-500");
    }

    function showError(msg) {
        $("#error-box").html(`
            <p class="text-red-500 bg-red-900 py-2 px-3 rounded text-sm text-center">${msg}</p>
        `);
    }

    function validateForm() {
        clearErrors();

        let pass = $("input[name='password']").val().trim();
        let cpass = $("input[name='confirm_password']").val().trim();

        if (pass.length < 6) {
            showError("Password must be at least 6 characters long.");
            $("input[name='password']").addClass("border-red-500");
            return false;
        }

        if (pass !== cpass) {
            showError("Passwords do not match.");
            $("input[name='confirm_password']").addClass("border-red-500");
            return false;
        }

        return true;
    }

    // Live validation
    $("input").on("input", function () {
        if (validateForm()) {
            $("#resetBtn").removeClass("opacity-60 cursor-not-allowed");
            $("#resetBtn").prop("disabled", false);
        } else {
            $("#resetBtn").addClass("opacity-60 cursor-not-allowed");
            $("#resetBtn").prop("disabled", true);
        }
    });

    // Form submission check
    $("#resetForm").on("submit", function (e) {
        if (!validateForm()) {
            e.preventDefault();
        }
    });

});
</script>

{% endblock %}
