{% extends "base.html" %}
{% load static %}

{% block title %}Order Details | Shoeverse{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#121714] text-white">
  <div class="mx-auto max-w-6xl px-4 py-6 lg:py-10">

    <!-- Breadcrumb -->
    <div class="flex flex-wrap items-center gap-2 text-sm text-[#96c4a8]">
      <a href="{% url 'order_list' %}" class="hover:underline">Orders</a>
      <span>/</span>
      <span class="text-white">Order Details</span>
    </div>

    <!-- Page Title -->
    <div class="py-5 text-center">
      <h1 class="text-2xl md:text-3xl font-bold">Order Details</h1>
      <p class="text-sm text-mint-100/70 mt-1">Order ID: #{{ order.order_id }}</p>
    </div>

    <!-- ORDER STATUS BOX -->
    <section class="rounded-2xl border border-[#2a3b31] bg-[#18211d] p-4 md:p-5 mb-6">
      <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <p class="text-base md:text-lg font-medium">
          Current Status: 
          <span class="text-mint-300 font-bold">{{ order.get_status_display }}</span>
        </p>

        <!-- Dynamic Status Badge -->
        <span class="
            inline-flex items-center rounded-full px-3 py-1 text-xs font-medium
            {% if order.status == 'Delivered' %}
                bg-green-600 text-white
            {% elif order.status == 'Shipped' %}
                bg-blue-500 text-white
            {% elif order.status == 'Processing' %}
                bg-yellow-500 text-black
            {% elif order.status == 'Cancelled' %}
                bg-red-600 text-white
            {% else %}
                bg-gray-500 text-white
            {% endif %}
        ">
          {{ order.get_status_display }}
        </span>
      </div>

      <!-- Visual progress bar -->
      <div class="mt-3 h-2 rounded-full bg-[#366347] overflow-hidden">
        <div class="h-full 
            {% if order.status == 'Pending' %} w-1/5 bg-yellow-500
            {% elif order.status == 'Processing' %} w-2/5 bg-blue-400
            {% elif order.status == 'Shipped' %} w-3/5 bg-blue-500
            {% elif order.status == 'Delivered' %} w-full bg-green-500
            {% elif order.status == 'Cancelled' %} w-full bg-red-600
            {% endif %}
        "></div>
      </div>

      {% if order.delivered_at %}
      <p class="mt-3 text-sm text-[#96c4a8]">
        Delivered on: {{ order.delivered_at|date:"M d, Y" }}
      </p>
      {% endif %}
    </section>

    <!-- MAIN CONTENT GRID -->
    <div class="grid gap-6 lg:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]">

      <!-- LEFT SECTION -->
      <div class="space-y-6">

        <!-- Product Items Loop -->
        {% for item in order.items.all %}
        <section class="rounded-2xl border border-[#2a3b31] bg-[#18211d] p-4 md:p-5">
          <div class="flex flex-col md:flex-row gap-4">

            <!-- Product Image -->
            <div class="w-full md:w-40">
              <img src="{{ item.variant.product.images.first.image.url }}"
                   class="rounded-2xl object-cover h-28 w-full md:w-40"
                   alt="{{ item.variant.product.name }}">
            </div>

            <!-- Product Info -->
            <div class="flex-1 space-y-2">
              <h2 class="text-lg font-bold">{{ item.variant.product.name }}</h2>
              <p class="text-sm text-[#96c4a8]">
                Size: {{ item.variant.size }} | Qty: {{ item.quantity }}
              </p>
              <p class="font-bold text-white text-lg">₹{{ item.total_price }}</p>
            </div>
          </div>
        </section>
        {% endfor %}

        <!-- DELIVERY ADDRESS -->
        <section class="rounded-2xl border border-[#2a3b31] bg-[#18211d] p-5">
          <h3 class="text-lg font-bold mb-3">Delivery Address</h3>
          <p class="text-sm">{{ order.address.full_name }}</p>
          <p class="text-sm text-[#96c4a8]">{{ order.address.address_line1 }}, {{ order.address.city }}, 
            {{ order.address.state }} - {{ order.address.pincode }}</p>
          <p class="text-sm">Phone: {{ order.address.phone_number }}</p>
        </section>
      </div>

      <!-- RIGHT SUMMARY -->
      <aside class="space-y-6">

        <!-- PRICE SUMMARY -->
        <section class="rounded-2xl border border-[#2a3b31] bg-[#18211d] p-5">
          <h3 class="text-lg font-bold mb-4">Payment Summary</h3>
          <div class="text-sm space-y-2">
            <div class="flex justify-between">
              <span>Subtotal</span>
              <span>₹{{ order.subtotal }}</span>
            </div>
            <div class="flex justify-between">
              <span>GST</span>
              <span>₹{{ order.gst }}</span>
            </div>
            <div class="flex justify-between">
              <span>Delivery Charge</span>
              <span>{% if order.delivery_charge == 0 %}Free{% else %}₹{{ order.delivery_charge }}{% endif %}</span>
            </div>
            <div class="border-t border-[#2f3e35] pt-3 flex justify-between font-bold">
              <span>Total</span>
              <span class="text-primary">₹{{ order.total_amount }}</span>
            </div>
          </div>
        </section>

        <!-- PAYMENT METHOD -->
        <section class="rounded-2xl border border-[#2a3b31] bg-[#18211d] p-4">
          <p class="text-sm flex justify-between">
            <span class="text-[#96c4a8]">Payment Method</span>
            <span class="text-white font-medium">{{ order.get_payment_method_display }}</span>
          </p>
        </section>

        <!-- ACTIONS -->
        <section class="rounded-2xl border border-[#2a3b31] bg-[#18211d] p-4 flex gap-3 justify-center">
          <a href="{% url 'download_invoice' order.order_id %}"
             class="rounded-xl bg-primary text-dark px-6 py-2 text-sm font-semibold">Download Invoice</a>

          {% if order.status == 'Delivered' %}
              <a href="#"
                 class="rounded-xl bg-red-500 text-white px-6 py-2 text-sm font-semibold">Return Order</a>
          {% endif %}
        </section>
      </aside>
    </div>
  </div>
</div>
{% endblock %}
