{% extends "base.html" %}
{% load static %}

{% block title %}My Wallet | Shoeverse{% endblock %}

{% block content %}
<div class="flex min-h-screen bg-[#121714] text-gray-200 font-sans selection:bg-[#366347] selection:text-white relative overflow-hidden">

    <!-- Background Ambient Glow -->
    <div class="absolute top-0 right-0 w-full h-full overflow-hidden pointer-events-none z-0">
        <div class="absolute top-[-10%] right-[-5%] w-96 h-96 bg-[#366347]/20 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-10%] left-[20%] w-[500px] h-[500px] bg-[#1a2e22]/30 rounded-full blur-[120px]"></div>
    </div>

    <!-- Sidebar -->
    <div class="z-20">
        {% include "users/profile_sidebar.html" %}
    </div>

    <!-- Main Content -->
    <main class="flex-1 p-4 lg:p-10 relative z-10">
        <div class="max-w-5xl mx-auto space-y-8">

            <!-- Page Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-white tracking-tight">My Wallet</h1>
                    <p class="text-sm text-gray-400 mt-1">Manage your payments and balance securely.</p>
                </div>
                
                <!-- Add Money Button (Triggers Modal) -->
                <button onclick="toggleAddMoneyModal()" class="group relative inline-flex items-center justify-center px-6 py-2.5 overflow-hidden font-medium text-white transition-all duration-300 bg-[#366347] rounded-xl hover:bg-[#2d523b] shadow-[0_0_20px_rgba(54,99,71,0.3)] hover:shadow-[0_0_30px_rgba(54,99,71,0.5)] border border-[#3d5244] cursor-pointer">
                    <span class="mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </span>
                    <span class="relative text-sm">Add Money</span>
                </button>
            </div>

            <!-- Digital Card & Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- The Wallet Card -->
                <div class="relative w-full h-64 bg-gradient-to-br from-[#1e2923] via-[#15201b] to-black rounded-2xl border border-[#2a3b31] shadow-2xl overflow-hidden group hover:border-[#366347]/50 transition-all duration-500">
                    
                    <!-- Card Texture -->
                    <div class="absolute inset-0 opacity-20" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noise%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noise)%22 opacity=%220.5%22/%3E%3C/svg%3E');"></div>
                    
                    <!-- Green Glow Blob -->
                    <div class="absolute -top-24 -right-24 w-64 h-64 bg-[#366347] rounded-full blur-[80px] opacity-40 group-hover:opacity-60 transition-opacity duration-500"></div>
                    
                    <div class="relative h-full p-8 flex flex-col justify-between z-10">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-[10px] font-bold tracking-[0.2em] text-gray-400 uppercase">Current Balance</p>
                                <h2 class="text-4xl font-bold text-white mt-2 tracking-tight">₹ {{ wallet.balance }}</h2>
                            </div>
                            <!-- Icon -->
                            <div class="w-10 h-10 rounded-full bg-white/5 backdrop-blur-md border border-white/10 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="text-[#366347]" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>
                            </div>
                        </div>

                        <div class="flex justify-between items-end">
                            <div>
                                <p class="text-[10px] text-gray-500 mb-1 uppercase tracking-wider">Wallet Holder</p>
                                <p class="text-sm font-medium text-gray-200 tracking-wider uppercase">{{ request.user.fullName }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[10px] text-gray-500 uppercase tracking-wider">Last Updated</p>
                                <p class="text-xs text-gray-300 font-mono mt-1">{{ wallet.updated_at|timesince }} ago</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mini Stats / Info Panel -->
                <div class="bg-[#18211d] rounded-2xl border border-[#2a3b31] p-8 flex flex-col justify-center gap-6 shadow-xl">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-[#366347]/10 flex items-center justify-center text-[#366347] border border-[#366347]/20">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="m17 5-5-3-5 3"/><path d="m17 19-5 3-5-3"/></svg>
                        </div>
                        <div>
                            <h3 class="text-white font-semibold text-sm">Secure Payment</h3>
                            <p class="text-xs text-gray-400 mt-0.5">Encrypted 256-bit security standards.</p>
                        </div>
                    </div>
                    <div class="w-full h-px bg-[#2a3b31]"></div>
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-[#366347]/10 flex items-center justify-center text-[#366347] border border-[#366347]/20">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <div>
                            <h3 class="text-white font-semibold text-sm">Instant Refunds</h3>
                            <p class="text-xs text-gray-400 mt-0.5">Refunds are credited directly to wallet.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="bg-[#18211d] rounded-2xl border border-[#2a3b31] shadow-xl overflow-hidden">
                <div class="p-6 border-b border-[#2a3b31] flex items-center justify-between">
                    <h3 class="text-lg font-bold text-white">Transaction History</h3>
                    <span class="text-[10px] uppercase font-bold tracking-wider text-gray-500 bg-[#2a3b31] px-3 py-1 rounded-full">{{ transactions.count }} Records</span>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-[#151c19]">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Details</th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-4 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Amount</th>
                                <th class="px-6 py-4 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-[#2a3b31]">
                            {% for txn in transactions %}
                            <tr class="group hover:bg-[#1c2621] transition-colors">
                                <td class="px-6 py-4">
                                    <div class="flex items-center gap-4">
                                        <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center border
                                            {% if txn.transaction_type == 'credit' %}
                                                bg-emerald-500/10 border-emerald-500/20 text-emerald-400
                                            {% else %}
                                                bg-rose-500/10 border-rose-500/20 text-rose-400
                                            {% endif %}">
                                            {% if txn.transaction_type == 'credit' %}
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="m19 12-7 7-7-7"/></svg>
                                            {% else %}
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5"/><path d="m5 12 7-7 7 7"/></svg>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-200 group-hover:text-white transition-colors">
                                                {{ txn.description|default:"Transaction" }}
                                            </p>
                                            <p class="text-xs text-gray-500 capitalize">{{ txn.transaction_type }}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <p class="text-xs text-gray-400 font-mono mb-1">#{{ txn.id|slice:":8" }}</p>
                                    <p class="text-xs text-gray-500">{{ txn.created_at|date:"M d, Y" }}</p>
                                </td>
                                <td class="px-6 py-4 text-right">
                                    <span class="text-sm font-bold tracking-wide
                                        {% if txn.transaction_type == 'credit' %} text-emerald-400 {% else %} text-gray-300 {% endif %}">
                                        {% if txn.transaction_type == 'credit' %}+{% else %}-{% endif %} ₹{{ txn.amount }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide bg-[#366347]/10 text-[#366347] border border-[#366347]/20">
                                        Completed
                                    </span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="px-6 py-12 text-center">
                                    <div class="flex flex-col items-center justify-center text-gray-500">
                                        <div class="w-16 h-16 bg-[#2a3b31]/50 rounded-full flex items-center justify-center mb-4">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 opacity-40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                            </svg>
                                        </div>
                                        <p class="text-sm font-medium">No transactions yet</p>
                                        <p class="text-xs text-gray-600 mt-1">Add money to get started</p>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>
</div>

<!-- PROFESSIONAL ADD MONEY MODAL -->
<!-- Backdrop with blur -->
<div id="addMoneyModal" class="fixed inset-0 z-[100] hidden transition-opacity duration-300 ease-out opacity-0" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    
    <!-- Dark overlay -->
    <div class="fixed inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="toggleAddMoneyModal()"></div>

    <!-- Modal Layout -->
    <div class="fixed inset-0 z-10 overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            
            <!-- Modal Panel -->
            <div id="modalPanel" class="relative transform overflow-hidden rounded-2xl bg-[#18211d] text-left shadow-[0_0_50px_rgba(0,0,0,0.5)] border border-[#2a3b31] transition-all sm:my-8 sm:w-full sm:max-w-md scale-95 opacity-0 duration-300">
                
                <!-- Decorative Glow -->
                <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-[#366347] rounded-full blur-[60px] opacity-20 pointer-events-none"></div>

                <!-- Modal Content -->
                <div class="p-6 sm:p-8 relative z-10">
                    
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-white tracking-tight" id="modal-title">Add Balance</h3>
                            <p class="text-xs text-gray-400 mt-1">Top up your Shoeverse wallet securely.</p>
                        </div>
                        <button onclick="toggleAddMoneyModal()" class="text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-white/5">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>

                    <!-- Form -->
                    <form method="post" action="{% url 'wallet_add_money' %}" id="addMoneyForm">
                        {% csrf_token %}
                        
                        <!-- Input Section -->
                        <div class="space-y-4">
                            <div class="relative group">
                                <label for="amount" class="block text-xs font-medium text-gray-400 uppercase tracking-wider mb-2 ml-1">Enter Amount</label>
                                <div class="relative">
                                    <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
                                        <span class="text-gray-400 text-lg">₹</span>
                                    </div>
                                    <input type="number" name="amount" id="amountInput" min="1" placeholder="0.00" required
                                        class="block w-full rounded-xl border border-[#2a3b31] bg-[#121714] py-4 pl-10 pr-4 text-2xl font-bold text-white placeholder-gray-600 focus:border-[#366347] focus:ring-1 focus:ring-[#366347] transition-all outline-none [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
                                </div>
                            </div>

                            <!-- Quick Amount Chips -->
                            <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                <button type="button" onclick="setAmount(500)" class="flex-shrink-0 px-4 py-2 rounded-lg bg-[#2a3b31]/50 border border-[#2a3b31] text-sm text-gray-300 hover:bg-[#366347] hover:text-white hover:border-[#366347] transition-all duration-200">+ ₹500</button>
                                <button type="button" onclick="setAmount(1000)" class="flex-shrink-0 px-4 py-2 rounded-lg bg-[#2a3b31]/50 border border-[#2a3b31] text-sm text-gray-300 hover:bg-[#366347] hover:text-white hover:border-[#366347] transition-all duration-200">+ ₹1,000</button>
                                <button type="button" onclick="setAmount(2000)" class="flex-shrink-0 px-4 py-2 rounded-lg bg-[#2a3b31]/50 border border-[#2a3b31] text-sm text-gray-300 hover:bg-[#366347] hover:text-white hover:border-[#366347] transition-all duration-200">+ ₹2,000</button>
                                <button type="button" onclick="setAmount(5000)" class="flex-shrink-0 px-4 py-2 rounded-lg bg-[#2a3b31]/50 border border-[#2a3b31] text-sm text-gray-300 hover:bg-[#366347] hover:text-white hover:border-[#366347] transition-all duration-200">+ ₹5,000</button>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="mt-8">
                            <button type="submit" class="w-full group relative flex items-center justify-center py-3.5 px-6 border border-transparent text-sm font-semibold rounded-xl text-white bg-[#366347] hover:bg-[#2d523b] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#366347] focus:ring-offset-[#121714] transition-all duration-200 shadow-[0_5px_15px_rgba(54,99,71,0.3)] hover:shadow-[0_8px_20px_rgba(54,99,71,0.4)]">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                    <svg class="h-5 w-5 text-emerald-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                    </svg>
                                </span>
                                Proceed to Pay
                            </button>
                            <p class="mt-4 text-center text-[10px] text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="inline w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                Payments are secured with 256-bit encryption
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Functions to handle Modal animation and Logic
    function toggleAddMoneyModal() {
        const modal = document.getElementById("addMoneyModal");
        const panel = document.getElementById("modalPanel");
        const body = document.body;
        
        if (modal.classList.contains("hidden")) {
            // Open Modal
            modal.classList.remove("hidden");
            // Prevent background scrolling
            body.style.overflow = "hidden"; 
            
            // Small timeout to allow the browser to render the 'block' before changing opacity
            setTimeout(() => {
                modal.classList.remove("opacity-0");
                panel.classList.remove("scale-95", "opacity-0");
                panel.classList.add("scale-100", "opacity-100");
            }, 10);
        } else {
            // Close Modal
            modal.classList.add("opacity-0");
            panel.classList.remove("scale-100", "opacity-100");
            panel.classList.add("scale-95", "opacity-0");
            
            // Wait for transition to finish before hiding
            setTimeout(() => {
                modal.classList.add("hidden");
                body.style.overflow = "auto";
            }, 300);
        }
    }

    // Helper for quick amount buttons
    function setAmount(value) {
        const input = document.getElementById('amountInput');
        input.value = value;
        // Briefly highlight the input to show it updated
        input.classList.add('ring-2', 'ring-[#366347]');
        setTimeout(() => {
            input.classList.remove('ring-2', 'ring-[#366347]');
        }, 200);
    }
</script>
{% endblock %}